
@{
    ViewBag.Title = "Distributors";
    Layout = "~/Views/Shared/ContentLayout.cshtml";
}

<style type="text/css">
    /* Style The Dropdown Button */
    .searchmenubtn {
        color: white;
        padding: 13px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        border: 1px !important;
        border-color: black !important;
    }

    /* The container <div> - needed to position the dropdown content */
    .searchmenu {
        position: relative;
        display: inline-block;
        border: 1px !important;
        border-color: black !important;
        z-index: 100;
    }

    /* Dropdown Content (Hidden by Default) */
    .searchmenu-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        top: 2.8em;
    }

        /* Links inside the dropdown */
        .searchmenu-content a {
            top: 1em;
            height: 20px !important;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: 13px !important;
            font-weight: normal !important;
            color: black;
            text-decoration: none !important;
            display: block;
        }

            /* Change color of dropdown links on hover */
            .searchmenu-content a:hover {
                top: -5px;
                background-color: #BCD8F3 !important;
                color: #800909 !important;
            }

    /* Show the dropdown menu on hover */
    .searchmenu:hover .searchmenu-content {
        display: block;
        margin-top: -10px;
    }

    .searchmenu-content:after {
        top: -7px;
        content: " ";
        left: 6%;
        position: absolute;
        width: 10px;
        height: 9px;
        border-right: 2px solid #0866c6;
        border-bottom: 2px solid #0866c6;
        background: white;
        transform: rotate(222deg);
    }

    /* Change the background color of the dropdown button when the dropdown content is shown */
    .searchmenu:hover .searchmenubtn {
    }

    .nallowed {
   cursor: not-allowed;
}
.event-none {
    pointer-events: none!important;
}
</style>

<style type="text/css">
    .ui-datepicker-year {
        width: 80px !important;
    }

    .ui-datepicker-month {
        width: 70px !important;
    }

    #ui-datepicker-div {
        z-index: 2000 !important;
        width: 223px;
    }

    .ui-datepicker-calendar thead {
        width: 100% !important;
    }

    .ui-datepicker-calendar tbody {
        overflow-y: overlay;
        width: 100% !important;
    }

    .textbox_size {
        width: 30%;
    }

    .combobox_size {
        width: 32%;
    }
</style>

<script type="text/javascript">
    var search;
    var blurevent = false;
    var dblclick = false;
    var parclick = false;
    var DistnNo = "";
    var Distfield = "";
    var Distfield_header = "";
    var distributorno;
    $(document).ready(function () {
        Dist = new viewModel();
        search = Dist;
        ko.applyBindings(Dist);

        $("#btnAdd").click({ handler: Dist.Add });
        $("#btnEdit").click({ handler: Dist.Edit });
        $("#btnSave").click({ handler: Dist.Save });
        $("#btnDelete").click({ handler: Dist.Delete });
        $("#btnCancel").click({ handler: Dist.Cancel });

        $("#datejoin").datepicker({ dateFormat: 'mm/dd/y', changeMonth: true, changeYear: true });
        $("#dateterm").datepicker({ dateFormat: 'mm/dd/y', changeMonth: true, changeYear: true });
        //Contacts Screen
        $("#Contacts").click(function () {
            $("#iContacts").contents().find("body").html('');
            document.getElementById('iContacts').src = "DistContacts";
        });

        //Notes Screen
        $("#Notes").click(function () {
            $("#iNotes").contents().find("body").html('');
            document.getElementById('iNotes').src = "Notes?No=" + document.getElementById('DistNo').value + "&ScreenName=Distributor";
        });
        //iRoomlist
        $("#Roomlist").click(function () {
            $("#iRoomlist").contents().find("body").html('');
            document.getElementById('iRoomlist').src = "Roomlist?No=" + document.getElementById('DistNo').value + "&ScreenName=Distributor";
        });

    });

    function viewModel() {

        var self = this;

        self.AddMode = ko.observable(false);
        self.EditMode = ko.observable(true);
        self.SaveMode = ko.observable(false);
        self.EnableDisableMode = ko.observable(true);
        self.EnableDisableControls = ko.observable(false);

        self.txtname = ko.observable();
        self.txtsearch = ko.observable();
        self.selectedvalue = ko.observable();
        self.DistNo = ko.observable();
        self.company = ko.observable();
        self.Olddistno = ko.observable();
        self.mailadd = ko.observable();
        self.city = ko.observable();
        self.sstate = ko.observable();
        self.state = ko.observable();
        self.zip = ko.observable();
        self.country = ko.observable([]);
        self.phone = ko.observable();
        self.phone2 = ko.observable();
        self.fax = ko.observable();
        self.officehrs = ko.observable();
        self.d_email = ko.observable();
        self.www = ko.observable();

        self.corpname = ko.observable();
        self.shipadd = ko.observable();
        self.scity = ko.observable();
        self.szip = ko.observable();
        self.scountry = ko.observable([]);
        self.webadd = ko.observable();
        self.ddtlink = ko.observable();
        self.primary_ = ko.observable([]);
        self.parentact = ko.observable();
        self.datejoin = ko.observable();
        self.dateterm = ko.observable();
        self.codea = ko.observable();


        self.CmbDistsrch = ko.observableArray([]);
        self.cmbcountry = ko.observableArray([]);
        self.cmbscountry = ko.observableArray([]);
        self.cmbprimary = ko.observableArray([]);
        self.cmbsecondary = ko.observableArray([]);

        self.Selecteditem = ko.observableArray([]);

        self.selectedvalue("company");
        self.txtname("Company");
        CallEnableTabs();

        $("#lblemail").live("click", function () {
            send_email(self.d_email());
        });

        self.Selecteditem = function (item) {
            if (item != undefined) {
                if (self.SaveMode() == true)
                    return false;

                DistnNo = item.DistNo;
                self.DistNo(item.DistNo);
                distributorno = item.DistNo;
                self.Olddistno(item.Olddistno);
                self.company(item.company);
                self.mailadd(item.mailadd);
                self.city(item.city);
                self.state(item.state.trim());
                self.zip(item.zip);
                self.country(item.country.trim());
                self.phone(item.phone);
                self.phone2(item.phone2);
                self.fax(item.fax);
                self.officehrs(item.officehrs);
                self.d_email(item.d_email);
                self.www(item.www);
                self.corpname(item.corpname);
                self.shipadd(item.shipadd);
                self.scity(item.scity);
                self.sstate(item.sstate.trim());
                self.szip(item.szip);
                self.scountry(item.scountry.trim());
                self.webadd(item.webadd);
                self.ddtlink(item.ddtlink);
                self.primary_(item.primary_.trim());
                if (item.parentact != null && item.parentact != "") {
                    self.parentact(item.parentact);

                    $.ajax({
                        url: "OpSearchList",
                        type: "POST",
                        data: { searchtable: 'Distributor', selectedvalue: "DistNo", searchtext: self.parentact() },
                        success: function (response) {
                            if (response.Items.length == 1) {
                                self.parentact(response.Items[0].DistNo);
                                document.getElementById('txtparentname').value = response.Items[0].company;
                                //return
                            }
                           
                        }
                    });
                }
                else {
                    //parclick = false;
                    self.parentact(item.parentact);
                    //self.Parentsearch();
                    document.getElementById('txtparentname').value = "";
                }

               
                self.codea(item.codea.trim());
               
                self.datejoin(DateBind(item.datejoin));
                self.dateterm(DateBind(item.dateterm));
                if (item.d_email != null && item.d_email != "") {
                    $("#lblemail").css("color", "blue");
                    $("#lblemail").css("cursor", "pointer");
                    $("#lblemail").css("text-decoration", "underline");
                }
                else {
                    $("#lblemail").css("color", "#333333");
                    $("#lblemail").css("cursor", "default");
                    $("#lblemail").css("text-decoration", "none");
                }

            }
        }

        $.ajax({
            url: "FillSearchComboList",
            type: "POST",
            data: { ScreenFrom: 'Distributors', FormClass: 'Distributors' },
            success: function (response) {
                Distfield_header = "", Distfield = "";
                var fld = "", desc = "";

                if (response.Items.length > 0) {
                    self.CmbDistsrch(response.Items);
                    for (var i = 0; i < response.Items.length; i++) {
                        desc += response.Items[i].Display_FName + ",";
                        fld += response.Items[i].Field_Name + ",";
                    }
                    Distfield_header = desc.replace(/,\s*$/, "");
                    Distfield = fld.replace(/,\s*$/, "");
                }
                else {
                    Distfield = "company,DistNo,Olddistno,city,state,country,zip,phone,d_email,codea";
                    Distfield_header = "Company,DistNo,OldDistNo,City,State,Country,Zip,Phone,Email,Query Filter";

                    var StaticHeadercmbo = "company-Company,DistNo-DistNo No,Olddistno-OldDistNo,city-City,state-State,country-Country,zip-Zip,phone-Phone,d_email-Email,codea-Query Filter";
                    var Comboheadsplit = StaticHeadercmbo.split(",");
                    var ComboArray = []
                    for (var i = 0; i < Comboheadsplit.length; i++) {
                        var Splitdesc = "";
                        Splitdesc = Comboheadsplit[i].split("-");
                        ComboArray.push({
                            Field_Name: Splitdesc[0],
                            Display_FName: Splitdesc[1]
                        });
                    }
                    self.CmbDistsrch(ComboArray);
                }
            }
        });

        $.ajax({
            url: "GetLookupList",
            data: { LukpID: 'CNTRY' },
            type: "POST",
            async: false,
            success: function (response) {
                self.cmbcountry(response.Items);
                self.cmbscountry(response.Items);

            }
        });

        $.ajax({
            url: "GetLookupList",
            data: { LukpID: 'PRIM' },
            type: "POST",
            async: false,
            success: function (response) {
                self.cmbprimary(response.Items);
            }
        });

        $.ajax({
            url: "GetLookupList",
            data: { LukpID: 'SECO' },
            type: "POST",
            async: false,
            success: function (response) {
                self.cmbsecondary(response.Items);
            }
        });



        self.Distsearchdbclick = function () {
            if (blurevent == true) {
                blurevent = false;
                return false;
            }
            dblclick = true;
            self.txtsearch(document.getElementById('Distsearch').value);
            if (self.txtsearch() == null || self.txtsearch() == "")
                self.txtsearch("%");

            $.ajax({
                url: "OpSearchList",
                type: "POST",
                data: { searchtable: 'Distributor', searchtext: self.txtsearch(), selectedvalue: self.selectedvalue() },
                success: function (response) {
                    if (response.Items.length == 1) {
                        self.Selecteditem(response.Items[0]);
                        $("a#webpageLink").attr("href", "http://" + response.Items[0].webadd);
                        if (self.webadd() != "") {
                            $("#webpageLink").show();
                            $("#webpage").hide();
                        }
                        else {
                            $("#webpageLink").hide();
                            $("#webpage").show();
                        }
                        
                        $("a#wwwwebpageLink").attr("href", "http://" + response.Items[0].www);
                        if (self.www() != "") {
                            $("#wwwwebpageLink").show();
                            $("#www").hide();
                        }
                        else {
                            $("#wwwwebpageLink").hide();
                            $("#www").show();
                        }
                    }
                    else {
                        var searchtext = self.txtsearch();
                        if (searchtext.indexOf('&') >= 0) { searchtext = searchtext.replace(/\&/g, 'amp;'); }
                        window.parent.document.getElementById('searchscreen').src = "../GroGroup/SearchScreen?element=txtDistsrch&table=Distributor&field=" + Distfield + "&header=" + Distfield_header + "&text=" + searchtext + "&where=" + self.selectedvalue() + "&LabelDescription=Distributor";
                        fireEvent(window.parent.document.getElementById('sc1'), 'click');
                    }
                    self.txtsearch("");
                }
            });
        }

        self.txtDistsearch = function () {
            if (dblclick == true) {
                dblclick = false;
                return false;
            }

            blurevent = true;

            self.txtsearch(document.getElementById('Distsearch').value);
            if (self.txtsearch() == null || self.txtsearch() == "") {
                return false;
            }

            $.ajax({
                url: "OpSearchList",
                type: "POST",
                data: { searchtable: 'Distributor', searchtext: self.txtsearch(), selectedvalue: self.selectedvalue() },
                success: function (response) {
                    if (response.Items.length == 1) {
                        self.Selecteditem(response.Items[0]);
                        $("a#webpageLink").attr("href", "http://" + response.Items[0].webadd);
                        if (self.webadd() != "") {
                            $("#webpageLink").show();
                            $("#webpage").hide();
                        }
                        else {
                            $("#webpageLink").hide();
                            $("#webpage").show();
                        }
                        $("a#wwwwebpageLink").attr("href", "http://" + response.Items[0].www);
                        if (self.www() != "") {
                            $("#wwwwebpageLink").show();
                            $("#www").hide();
                        }
                        else {
                            $("#wwwwebpageLink").hide();
                            $("#www").show();
                        }
                    }
                    else {
                        var searchtext = self.txtsearch();
                        if (searchtext.indexOf('&') >= 0) { searchtext = searchtext.replace(/\&/g, 'amp;'); }
                        window.parent.document.getElementById('searchscreen').src = "../GroGroup/SearchScreen?element=txtDistsrch&table=Distributor&field=" + Distfield + "&header=" + Distfield_header + "&text=" + searchtext + "&where=" + self.selectedvalue() + "&LabelDescription=Distributor";
                        fireEvent(window.parent.document.getElementById('sc1'), 'click');
                    }
                    self.txtsearch("");
                    blurevent = false;
                }
            });
        }

        self.Parentsearch = function () {
            if (parclick == true) {
                parclick = false;
                return false;
            }
            self.parentact(document.getElementById('txtparent').value);
            if (self.parentact() == null || self.parentact() == "") {
                document.getElementById('txtparentname').value = "";
                return false;
            }
            $.ajax({
                url: "OpSearchList",
                type: "POST",
                data: { searchtable: 'Distributor', selectedvalue: "DistNo", searchtext: self.parentact() },
                success: function (response) {
                    if (response.Items.length == 1) {
                        self.parentact(response.Items[0].DistNo);
                        document.getElementById('txtparentname').value = response.Items[0].company;
                        return;
                    }
                    else {
                        var searchtext = self.parentact();
                        if (searchtext.indexOf('&') >= 0) { searchtext = searchtext.replace(/\&/g, 'amp;'); }
                        window.parent.document.getElementById('searchscreen').src = "../GroGroup/SearchScreen?element=Parent&table=Distributor&field=DistNo,Olddistno,company&header=DistNo,Old DistNo,company&text=" + searchtext + "&where=DistNo&LabelDescription=Distributor";
                        fireEvent(window.parent.document.getElementById('sc1'), 'click');
                    }
                    self.parentact("");
                    document.getElementById('txtparentname').value = "";
                }
            });
        }
        self.Parentdbclick = function () {
            parclick = true;
            self.parentact(document.getElementById('Distsearch').value);
            if (self.parentact() == null || self.parentact() == "")
                self.parentact("%");

            $.ajax({
                url: "OpSearchList",
                type: "POST",
                data: { searchtable: 'Distributor', selectedvalue: "DistNo", searchtext: self.parentact() },
                success: function (response) {
                    if (response.Items.length == 1) {
                        self.parentact(response.Items[0].DistNo);
                        document.getElementById('txtparentname').value = response.Items[0].company;
                        return
                    }
                    else {
                        var searchtext = self.parentact();
                        if (searchtext.indexOf('&') >= 0) { searchtext = searchtext.replace(/\&/g, 'amp;'); }
                        window.parent.document.getElementById('searchscreen').src = "../GroGroup/SearchScreen?element=Parent&table=Distributor&field=DistNo,Olddistno,company&header=DistNo,Old DistNo,company&text=" + searchtext + "&where=DistNo&LabelDescription=Distributor";
                        fireEvent(window.parent.document.getElementById('sc1'), 'click');
                    }
                    self.parentact("");
                    document.getElementById('txtparentname').value = "";
                }
            });

        }

        DistnNo = self.DistNo();

        function DistributorList() {
            $.ajax({
                url: "FillDistGrid",
                data: { DistnNo: DistnNo },
                type: "POST",
                success: function (response) {
                    self.Selecteditem(response.Items[0]);

                    $("a#webpageLink").attr("href", "http://" + response.Items[0].webadd);
                    if (self.webadd() != "") {
                        $("#webpageLink").show();
                        $("#webpage").hide();
                    }
                    else {
                        $("#webpageLink").hide();
                        $("#webpage").show();
                    }
                    $("a#wwwwebpageLink").attr("href", "http://" + response.Items[0].www);
                    if (self.www() != "") {
                        $("#wwwwebpageLink").show();
                        $("#www").hide();
                    }
                    else {
                        $("#wwwwebpageLink").hide();
                        $("#www").show();
                    }
                }
            });
        }



        DistributorList();
        self.Add = function () {
            if (self.SaveMode() == true)
                return false;

            CallDisableTabs();

            self.DistNo("");
            self.company("");
            self.mailadd("");
            self.city("");
            self.state("");
            self.zip("");
            self.country("");
            self.phone("");
            self.phone2("");
            self.fax("");
            self.officehrs("");
            self.d_email("");
            self.www("");
            self.corpname("");
            self.shipadd("");
            self.scity("");
            self.sstate("");
            self.szip("");
            self.scountry("");
            self.webadd("");
            self.ddtlink("");
            self.primary_("");
            self.parentact("");
            self.datejoin("");
            self.dateterm("");
            self.codea("");

            if (self.webadd() != "") {
                $("#webpageLink").show();
                $("#webpage").hide();
            }
            else {
                $("#webpageLink").hide();
                $("#webpage").show();
            }

            if (self.www() != "") {
                $("#wwwwebpageLink").show();
                $("#www").hide();
            }
            else {
                $("#wwwwebpageLink").hide();
                $("#www").show();
            }
            document.getElementById('txtparentname').value = "";
            $("#lblemail").css("color", "#333333");
            $("#lblemail").css("cursor", "default");
            $("#lblemail").css("text-decoration", "none");
            $('#txtparent').css("background-color", "#C7F3AD");

            self.AddMode(true);
            self.SaveMode(true);
            self.EditMode(false);
            self.EnableDisableMode(false);
            self.EnableDisableControls(true);
            document.getElementById('company').focus();
        }

        self.Edit = function () {

            CallDisableTabs();

            self.AddMode(false);
            self.SaveMode(true);
            self.EditMode(false);
            self.EnableDisableMode(false);
            self.EnableDisableControls(true);
            $("#webpageLink").hide();
            $("#webpage").show();

            $("#wwwwebpageLink").hide();
            $("#www").show();
            $('#txtparent').css("background-color", "#C7F3AD");

            document.getElementById('mailadd').focus();
        }

        self.txtzipsearch = function () {
            if (self.SaveMode() == true) {
                if (self.state() == "" && self.city() == "") {
                    self.zip(document.getElementById('zip').value);
                    if (self.zip() == null || self.zip() == "") {
                        return false;
                    }
                    $.ajax({
                        url: "searchzip",
                        data: { getzip: self.zip() },
                        type: "POST",
                        success: function (response) {
                            if (response.Items.length > 0) {
                                self.city(response.Items[0].City);
                                self.state(response.Items[0].State);
                            }
                            else {
                                self.city("");
                                self.state("");
                            }

                        }
                    });
                }
                else {
                    return false;
                }

            }

        }

        self.txtszipsearch = function () {
            if (self.SaveMode() == true) {
                if (self.sstate() == "" && self.scity() == "") {
                    self.szip(document.getElementById('szip').value);
                    if (self.szip() == null || self.szip() == "") {
                        return false;
                    }
                    $.ajax({
                        url: "searchzip",
                        data: { getzip: self.szip() },
                        type: "POST",
                        success: function (response) {
                            if (response.Items.length > 0) {
                                self.scity(response.Items[0].City);
                                self.sstate(response.Items[0].State);
                            }
                            else {
                                self.scity("");
                                self.sstate("");
                            }
                        }
                    });
                }
                else {
                    return false;
                }
            }
        }

        self.Save = function () {
            if (self.company() == null || self.company() == "") {
                $.msgBox({
                    title: "Gro Group",
                    content: "Please enter the company",
                    type: "info",
                    parent: true,
                    buttons: [{ value: "Ok" }],
                    afterClose: function (result) {
                        document.getElementById('company').focus();
                    }
                });
                return false;
            }

            //if (self.phone() == null || self.phone() == "") {
            //    $.msgBox({
            //        title: "Gro Group",
            //        content: "Please enter the phone1",
            //        type: "info",
            //        parent: true,
            //        buttons: [{ value: "Ok" }],
            //        afterClose: function (result) {
            //            document.getElementById('phone').focus();
            //        }
            //    });
            //    return false;
            //}

            if (self.phone() != null && self.phone() != "") {
                if (self.phone().length < 12) {
                    $.msgBox({
                        title: "Gro Group",
                        content: "Please enter the Valid Phone no",
                        type: "info",
                        buttons: [{ value: "Ok" }],
                        afterClose: function (result) {
                            document.getElementById('phone').focus();
                        }
                    });
                    return false;
                }
            }
            if (self.phone2() != null && self.phone2() != "") {
                if (self.phone2().length < 12) {
                    $.msgBox({
                        title: "Gro Group",
                        content: "Please enter the Valid Phone no",
                        type: "info",
                        buttons: [{ value: "Ok" }],
                        afterClose: function (result) {
                            document.getElementById('phone2').focus();
                        }
                    });
                    return false;
                }
            }
            if (self.fax() != null && self.fax() != "") {
                if (self.fax().length < 12) {
                    $.msgBox({
                        title: "Gro Group",
                        content: "Please enter the Valid Fax no",
                        type: "info",
                        buttons: [{ value: "Ok" }],
                        afterClose: function (result) {
                            document.getElementById('fax').focus();
                        }
                    });
                    return false;
                }
            }

            //if (self.ddtlink() == null || self.ddtlink() == "") {
            //    $.msgBox({
            //        title: "Gro Group",
            //        content: "Please enter the ddtlink",
            //        type: "info",
            //        parent: true,
            //        buttons: [{ value: "Ok" }],
            //        afterClose: function (result) {
            //            document.getElementById('ddtlink').focus();
            //        }
            //    });
            //    return false;
            //}

            if (self.d_email() != "" && self.d_email() != null) {
                if (!ValidateEmail(self.d_email())) {
                    $.msgBox({
                        title: "Gro Group", content: "Invalid email",
                        afterClose: function (result) {
                            self.d_email("");
                            document.getElementById('Email').focus();
                        }
                    });
                    return false;
                }
            }
            if (self.datejoin() != null && self.datejoin() != "") {
                var isdatecomplvalidate = isValidDate(self.datejoin());
                if (isdatecomplvalidate == false) {
                    $.msgBox({
                        title: "Gro Group",
                        content: "Please enter the valid Date Joined",
                        type: "info",
                        buttons: [{ value: "Ok" }],
                        afterClose: function (result) {
                            document.getElementById('datejoin').focus();
                        }
                    });
                    return false;
                }
            }
            if (self.dateterm() != null && self.dateterm() != "") {
                var isdatecomplvalidate = isValidDate(self.dateterm());
                if (isdatecomplvalidate == false) {
                    $.msgBox({
                        title: "Gro Group",
                        content: "Please enter the valid Date Terminated",
                        type: "info",
                        buttons: [{ value: "Ok" }],
                        afterClose: function (result) {
                            document.getElementById('dateterm').focus();
                        }
                    });
                    return false;
                }
            }


            $.ajax({
                url: "ValidateDistCompany",
                data: { company: self.company(), AddMode: self.AddMode(), distributorno: distributorno },
                type: "POST",
                async: false,
                success: function (response) {
                    if (response.Items == true) {
                        $.msgBox({
                            title: "Gro Group", content: "Company already exists",
                            afterClose: function (result) {
                                self.txtcompany("");
                                $("#company").focus();
                                return false;
                            }
                        });
                    }
                    else {
                        SaveDistributor();
                    }
                }
            });

        }

        function SaveDistributor() {
            DistArray = [];
            DistArray =
                {
                    DistNo: self.DistNo(),
                    company: self.company(),
                    mailadd: self.mailadd(),
                    city: self.city(),
                    state: self.state(),
                    zip: self.zip(),
                    country: self.country(),
                    phone: self.phone(),
                    phone2: self.phone2(),
                    fax: self.fax(),
                    officehrs:self.officehrs(),
                    d_email: self.d_email(),
                    www:self.www(),
                    corpname:self.corpname(),
                    shipadd: self.shipadd(),
                    scity: self.scity(),
                    sstate: self.sstate(),
                    szip: self.szip(),
                    scountry: self.scountry(),
                    webadd: self.webadd(),
                    ddtlink: self.ddtlink(),
                    primary_: self.primary_(),
                    parentact: self.parentact(),
                    datejoin: self.datejoin(),
                    dateterm: self.dateterm(),
                    codea: self.codea(),
                }
            $.ajax({
                url: "SaveDistributor",
                data: { ObjDistArray: JSON.stringify(DistArray), DistNo: self.DistNo(), IsAddMode: self.AddMode() },
                type: "POST",
                async: false,
                success: function (response) {
                    self.DistNo(response.Items);
                    DistnNo = response.Items;
                    if (response.ItemMsg != undefined && response.ItemMsg != null) {
                        alert("Gro Group", response.ItemMsg);
                    } else {
                        DistNo = response.Items;
                        DistributorList();
                    }
                }
            });

            CallEnableTabs();

            self.AddMode(false);
            self.EditMode(true);
            self.SaveMode(false);
            self.EnableDisableMode(true);
            self.EnableDisableControls(false);
        }

        self.Cancel = function () {
            if (self.SaveMode() != true)
                return false;
            alertconfirm("Are You Sure", "Do you want to cancel current changes ?", self.confirmcancel, true, false);
        }

        self.confirmcancel = function () {
            DistributorList();

            CallEnableTabs();

            self.AddMode(false);
            self.EditMode(true);
            self.SaveMode(false);
            self.EnableDisableMode(true);
            self.EnableDisableControls(false);


            if (self.webadd() != "") {
                $("#webpageLink").show();
                $("#webpage").hide();
            }
            else {
                $("#webpageLink").hide();
                $("#webpage").show();
            }

            if (self.www() != "") {
                $("#wwwwebpageLink").show();
                $("#www").hide();
            }
            else {
                $("#wwwwebpageLink").hide();
                $("#www").show();
            }

            $('#txtparent').css("background-color", "white");
        }

        self.Delete = function () {
            if (self.SaveMode() == true)
                return false;
            alerterror("Denied", "Record cannot be deleted");
            //if (self.SaveMode() == true)
            //    return false;
            //alertconfirm("Delete", "Are you sure you want to delete this record ?", self.confirmdelete, false, true);
        }

        self.confirmdelete = function () {
            $.ajax({
                url: "DeleteDistributor",
                data: { DistnNo: DistnNo },
                type: "POST",
                success: function (response) {
                    DistributorList();
                }
            });
        }

        self.optionselect = function (item, element) {
            var obj = element.currentTarget.childNodes[0];
            self.selectedvalue(obj.value);
            self.txtname(element.currentTarget.childNodes[0].innerHTML);
            document.getElementById('Distsearch').focus();
        }

        self.searchselecteditem = function (item, element) {
            if (element == "txtDistsrch") {
                self.company(item[0]);
                DistnNo = item[1];
                self.DistNo(item[1]);
                DistributorList();
                self.txtsearch("");
            }
            else if (element == "Parent") {
                self.parentact(item[0]);
                document.getElementById('txtparentname').value = item[2];
            }
        }


    }

    function CallDisableTabs() {
        var tablist = document.getElementsByClassName('ui-tabs-nav ui-helper-reset');
        var lis = document.getElementsByClassName("ui-state-default ui-corner-top");
        var list = document.getElementsByClassName("ui-tabs-active ui-state-active");
        for (var i = 0; i < lis.length; i++) {
            if (list[0].childNodes[0].id != lis[i].childNodes[0].id) {
                $('#' + tablist[0].id + '').addClass("nallowed");
                $('#' + lis[i].childNodes[0].id + '').addClass("event-none");
            }
        }

    }
    function CallEnableTabs() {

        var tablist = document.getElementsByClassName('ui-tabs-nav ui-helper-reset');
        var lis = document.getElementsByClassName("ui-state-default ui-corner-top");
        var list = document.getElementsByClassName("ui-tabs-active ui-state-active");
        for (var i = 0; i < lis.length; i++) {
            $('#' + tablist[0].id + '').removeClass("nallowed");
            $('#' + lis[i].childNodes[0].id + '').removeClass("event-none");
        }
    }

    function isValidDate(dateString) {
        var dtRegex = new RegExp(/\b\d{1,2}[\/-]\d{1,2}[\/-]\d{2}\b/);
        return dtRegex.test(dateString);

    }

    function DateBind(date) {
        if (date != "" && date != null) {
            var inputdate = new Date(date);
            var year = inputdate.getFullYear();
            var InputDateFormat = ("0" + (inputdate.getMonth() + 1)).slice(-2) + "/" + ("0" + inputdate.getDate()).slice(-2) + "/" + year.toString().substr(2);
            return InputDateFormat;
        }
    }

</script>

<div id="tabs" class="tabbedwidget tab-primary">
    <div class="row-fluid">
        <ul id="tablist">
            <li><a href="#menu1" id="CompanyProfiles">Distributors</a></li>
            <li><a href="#menu2" id="Contacts">Contacts</a></li>
            <li><a href="#menu3" id="Notes">Notes</a></li>
            <li><a href="#menu4" id="Roomlist">Room list</a></li>
        </ul>
    </div>
    <div id="menu1">
        <center>
            <div style="max-width:1200px !important; text-align:left;margin-top:10px">
                <div class="row-fluid">
                    <div class="span4">
                        <ul class="list-nostyle list-inline tooltipsample">
                            <li data-bind="enable:EditMode"><a data-placement="bottom" data-rel="tooltip" data-original-title="Add" title="Add" class="btn btn-primary" id="btnAdd"><i class="icon-file icon-white"></i></a></li>
                            <li data-bind="visible: EditMode"><a data-placement="bottom" data-rel="tooltip" data-original-title="Edit" title="Edit" class="btn btn-warning" id="btnEdit"><i class="icon-edit icon-white"></i></a></li>
                            <li data-bind="visible: SaveMode"><a data-placement="bottom" data-rel="tooltip" data-original-title="Save" title="Save" class="btn btn-warning" id="btnSave"><i class="icon-list-alt icon-white"></i></a></li>
                            <li data-bind="enable:EditMode"><a data-placement="bottom" data-rel="tooltip" data-original-title="Delete" title="Delete" class="btn btn-danger" id="btnDelete"><i class="icon-remove icon-white"></i></a></li>
                            <li data-bind="enable:SaveMode"><a data-placement="bottom" data-rel="tooltip" data-original-title="Cancel" title="Cancel" class="btn btn-info" id="btnCancel"><i class="iconsweets-arrowleft iconsweets-white"></i></a></li>
                        </ul>
                    </div>
                    <div class="span4">
                        <div class="searchmenu">
                            <a href="#" class="btn btn-primary searchmenubtn" style="width:3px !important; height:1px; float: none !important;" id="btnsearch"><i style="margin-top:-8px; margin-left:-5px;" class="iconsweets-magnifying iconsweets-white"></i></a>
                            <ul class="searchmenu-content" data-bind="foreach: $root.CmbDistsrch">
                                <li style="cursor: pointer; list-style-type:none;" data-bind="click: $root.optionselect"><a data-bind="text: Display_FName,value:Field_Name"></a></li>
                            </ul>
                        </div>
                        <input type="text" class="input-large" id="Distsearch" style="font-weight:normal" data-bind="disable:EnableDisableControls,value: txtsearch,event:{blur:txtDistsearch,dblclick: Distsearchdbclick},attr:{placeholder:txtname}" />
                    </div>
                </div>
                
                <div class="row-fluid">
                    <div class="span6">
                        <div class="widgetbox">
                            <h4 class="widgettitle"><span>COMPANY PROFILES - </span><span>Old Dist. No.:</span><span id="oldmfgno" data-bind="text:Olddistno"></span></h4>
                            <div class="padding-style" style="border: 1px#BCD8F3 solid;">
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Account #/Company</label>
                                        <input id="DistNo" type="text" class="input-small" data-bind="disable:EnableDisableMode,value:DistNo" readonly="readonly" />
                                        <input id="company" type="text" maxlength="50" class="input-large" style="width:47%;" data-bind="disable:EnableDisableMode,value:company" required />
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Mail Address</label>
                                        <input id="mailadd" type="text" class="input-large" style="width: 366px;" maxlength="35" data-bind="disable:EnableDisableMode,value: mailadd" />
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span"> City</label>
                                        <input type="text" class="input-large" style="width: 366px;" maxlength="20" data-bind="disable:EnableDisableMode, value: city" />
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span"> St-Pr/Zip/Country</label>
                                        <input type="text" class="input-small mob-state-width" style="width:40px;" maxlength="2" data-bind="disable:EnableDisableMode,value: state" />
                                        <input id="zip" type="text" class="input-small mob-zip-width" maxlength="10" data-bind="disable:EnableDisableMode,value: zip,event:{blur:txtzipsearch}" />
                                        <select class="input-small mob-cntry-width" data-bind="disable:EnableDisableMode, options:cmbcountry,optionsText:'descript',optionsValue:'entry',value:country"></select>
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span"> Phone1/Phone2</label>
                                        <input id="phone" type="text" class="input-medium mob-text" style="width:120px;" onkeypress="return numbersonly(this,event,true);" maxlength="12" data-bind="disable:EnableDisableMode,value:phone" />
                                        <input id="phone2" type="text" class="input-medium mob-text" style="width:120px;" onkeypress="return numbersonly(this,event,true);" maxlength="12" data-bind="disable:EnableDisableMode,value:phone2" />
                                    </div>
                                </div>
                               
                                <div class="row-fluid">
                                    <div class="span8">
                                        <label class="span6 mob-span">Fax</label>
                                        <input type="text" id="fax" class="input-large" style="width:120px;" onkeypress="return numbersonly(this,event,true);" maxlength="12" data-bind="disable:EnableDisableMode, value: fax" />
                                    </div>
                                    <div class="span4 mrgleft" >
                                        <label class="span5 mob-span">Office Hrs.</label>
                                        <input type="text" class="input-large" style="width:90px;"  maxlength="11" data-bind="disable:EnableDisableMode,value: officehrs" />        
                                    </div>
                                </div>

                                <div class="row-fluid">
                                    <div class="span12">
                                        <label id="lblemail" class="span4 mob-span">Company Email</label>
                                        <input id="Email" type="email" class="input-large" style="width:312px" maxlength="40" data-bind="disable:EnableDisableMode, value: d_email" />
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Website</label>
                                        <input id="www" type="text" class="input-large" style="width:312px" maxlength="40" data-bind="disable: EnableDisableMode,value:www" />       
                                        <a id="wwwwebpageLink" target="_blank" href=""><span data-bind="text: www"></span></a> 
                                    </div>
                                </div>

                                <div class="row-fluid mob-disp-none" style="margin-top: 30px;"></div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Primary</label>
                                        <select id="primary" style="background-color:white; width:130px;" class="input-small mob-cmb" data-bind="disable:EnableDisableMode, options:cmbprimary,optionsText:'descript',optionsValue:'entry',value:primary_"></select>
 </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">P&S Link</label>
                                        <input id="ddtlink" type="text" class="input-large" maxlength="6" data-bind="disable:EnableDisableMode, value: ddtlink" />
  </div>
                                </div>
                               
                                <div class="row-fluid mob-disp-none" style="margin-top: 90px;"></div>

                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <div class="widgetbox">
                            <h4 class="widgettitle">CORPORATE INFORMATION</h4>
                            <div class="padding-style" style="border: 1px #BCD8F3 solid;">
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Corp.Name</label>
                                        <input id="corplink" type="text" class="input-large" style="width:60%;" maxlength="40" data-bind="disable: EnableDisableMode,value:corpname" />    
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span"> Ship Address</label>
                                        <input type="text" class="input-large" style="width: 335px;" maxlength="35" data-bind="disable:EnableDisableMode,value: shipadd" />
</div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span"> City</label>
                                        <input type="text" class="input-large" style="width: 335px;" maxlength="20" data-bind="disable:EnableDisableMode, value: scity" />
 </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">St-Pr/Zip/Country</label>
                                        <input type="text" style="width:40px;" class="mob-state-width" maxlength="2" data-bind="disable:EnableDisableMode,value: sstate" />
                                        <input id="szip" type="text" style="width:65px;" class="input-small mob-zip-width" maxlength="10" data-bind="disable:EnableDisableMode,value: szip,event:{blur:txtszipsearch}" />
                                        <select style="background-color:white;" class="input-small mob-cntry-width" data-bind="disable:EnableDisableMode,options:cmbscountry,optionsText:'descript',optionsValue:'entry',value:scountry"></select>
</div>
                                </div>

                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Corporate website:</label>
                                        <input id="webpage" type="text" class="input-large" maxlength="40" data-bind="disable:EnableDisableMode, value: webadd" />
                                        <a id="webpageLink" target="_blank" href=""><span data-bind="text: webadd"></span></a>
                                    </div>
                                </div>
                                <div class="row-fluid mob-disp-none" style="margin-top: 30px;"></div>
                                <div class="row-fluid">
                                    <label class="span12" style="font-weight:bold">Member Information</label>
                                </div>
                               
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Date Joined</label>
                                        <input id="datejoin" type="text" class="input-small mob-text" placeholder="MM/DD/YY" maxlength="8" data-bind="disable:EnableDisableMode, value:datejoin" />
 </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Date Terminated</label>
                                        <input id="dateterm" type="text" class="input-small mob-text" placeholder="MM/DD/YY" maxlength="8" data-bind="disable:EnableDisableMode, value:dateterm" />
</div>
                                </div>

                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Parent Account #</label>
                                        <input type="text" id="txtparent" class="input-small mob-text" maxlength="6" data-bind="disable:EnableDisableMode,value: parentact,event:{blur:Parentsearch,dblclick: Parentdbclick}" />
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label class="span4 mob-span">Parent Name</label>
                                        <input type="text" id="txtparentname" class="input-medium mob-text" style="width:220px;" data-bind="disable:EnableDisableMode" readonly="readonly" />
                                    </div>
                                </div>

                                <div class="row-fluid mob-disp-none" style="margin-top: 60px;"></div>
                                <div class="row-fluid">
                                    <div class="span6"></div>
                                    <div class="span6 mob-wd-full">
                                        <label class="span7 mob-span">Optional Query Field</label>
                                        <input id="codea" class="input-small" style="width:70px;" type="text" maxlength="1" data-bind="disable: EnableDisableMode, value: codea" /> 
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>



            </div>
        </center>
    </div>
    <div id="menu2">
        <div style="height: 800px">
            <iframe id="iContacts" width="98%" height="100%" scrolling="no" frameborder="0"></iframe>
        </div>
    </div>
    <div id="menu3">
        <div style="height: 800px">
            <iframe id="iNotes" width="98%" height="100%" scrolling="no" frameborder="0"></iframe>
        </div>
    </div>
    <div id="menu4">
        <div style="height: 800px;margin-top: 1%;">
            <iframe id="iRoomlist" width="98%" height="100%" scrolling="no" frameborder="0"></iframe>
        </div>
    </div>
</div>



